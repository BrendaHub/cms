<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shishuo.cms.dao.FileDao">

	<select id="getFileById" parameterType="long"
		resultType="com.shishuo.cms.entity.vo.FileVo">
		select * from file where fileId=#{fileId}
	</select>

	<insert id="addFile" parameterType="com.shishuo.cms.entity.File">
		insert into
		file(folderId,adminId,picture,name,content,viewCount,commentCount,type,status,createTime)
		value(#{folderId},#{adminId},#{picture},#{name},#{content},#{viewCount},#{commentCount},#{type},#{status},#{createTime})
		<selectKey resultType="long" keyProperty="fileId">
			SELECT
			LAST_INSERT_ID()	
		</selectKey>
	</insert>

	<delete id="deleteFile" parameterType="com.shishuo.cms.entity.File">
		delete from file where
		fileId=#{fileId} and status=#{status}
	</delete>
	<select id="getFileListByFoderId" resultType="com.shishuo.cms.entity.vo.FileVo">
		select * from file
		where type = #{type} <if test="folderId!=0">and folderId=#{folderId}</if>and status=#{status} limit #{offset},#{rows}
	</select>

	<select id="getFileCountByFoderId" resultType="Integer">
		select count(*) from file where type = #{type}<if test="folderId!=0">and folderId=#{folderId}</if>
	</select>

	<update id="updateFile" parameterType="com.shishuo.cms.entity.File">
		update file set
		folderId=#{folderId},name=#{name},picture=#{picture},
		content=#{content},status=#{status}
		where fileId=#{fileId}
	</update>

	<update id="updateStatusByFileId">
		update file set
		status=#{status} where fileId=#{fileId}
	</update>
	
	<update id="updateViewCount" parameterType="long">
		update file set
		viewCount = #{viewCount} where fileId = #{fileId}
	</update>
	
	<update id="updateCommentCount" parameterType="long">
		update file set
		commentCount = #{commentCount} where fileId = #{fileId}
	</update>

	<select id="getFileListByType" resultType="com.shishuo.cms.entity.vo.FileVo">
		select * from file
		where type=#{type} and status=#{status} order by createTime desc limit #{offset},#{rows} 
	</select>

	<select id="getFileListByTypeCount" resultType="Integer">
		select count(*)
		from file where type=#{type}
	</select>
	
</mapper>  
